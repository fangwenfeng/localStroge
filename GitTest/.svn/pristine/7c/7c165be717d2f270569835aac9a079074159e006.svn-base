<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>云API</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/common.css"/>
    <style>
        .empty{ text-align: center; padding: 15px; }
        #con{
			margin:10px;
			font-size: 28px; 
		}
		ul{
			margin-bottom:10px;
		}
		.txt{ 
			margin:5px 10px;
			padding:5px;
			color:#000;
			word-wrap: break-word;
		}
		input[type="text"]{
			border-radius: 6px;
		    background-color: #FFFFFF;
		    height: 36px;
		    border: 1px solid #D2CCCE;
		    color: #D2CCCE;
		    line-height: 36px;
		    text-indent: 7px;
		    width:120px;
		    background-clip:padding-box;
		}
		input[type="button"],#con{
			border-radius: 6px;
		    background-color: #81A9C3;
		    height: 36px;
		    border: 1px solid #D2CCCE;
		    color: #FFFFFF;
		    line-height: 36px;
		    padding-left:30px;
		    padding-right:30px;
		    background-clip:padding-box;
		}
		span {
            padding: 5px 15px;
            margin: 10px;
            display: inline-block;
            background-color: #e8e8e8;
        }
    </style>
</head>
<body>
    <input type="button" onclick="reg_sms()" value="sendsms注册短信模块" /><br><br>
	手机号<input type="text" id="tel" name="tel" value="18215552696" placeholder="输入手机号" />
    <input type="button" class="yzm-btn" onclick="send_sms()" value="发送验证码" /><br><br>
	验证码<input type="text" id="code" name="code" value="" />
    <input type="button" onclick="code_sms()" value="短信验证" /><br><br><br><br><br><br><br><br>
    <div class="empty">
       <button onclick="openScanner()">开启二维码扫描</button>
    </div>

    <span tapmode onclick="smsVerifyLogin();">smsVerify注册短信模块</span>
    <span tapmode onclick="smsVerifySend();">发送验证码</span>
    <span tapmode onclick="smsVerifyVoice();">发送语音验证</span>
    <span tapmode onclick="smsVerifyVerify();">短信验证</span>
</body>
<script src="../script/api.js"></script>
<script src="../script/zepto.min.js "></script>
<script>
	var sendsms;
	var smsVerify;
	apiready = function(){
	    sendsms = api.require('sendSms');
	    smsVerify = api.require('smsVerify');
	}
	function smsVerifyLogin(){
		smsVerify.register(function(ret, err){
		    if(ret.status){
		        api.alert({msg: '注册成功'});
		    }else{
		        api.alert({msg: err.code+' 注册失败'});
		    }
		});
	}
	function smsVerifySend(){
		smsVerify.sms({
		    phone:"18215552696",
		    country:"86"
		},function(ret, err){
		    if(ret.status){
		        if( ret.smart == true ){    // 安卓版特有功能 智能验证
		            api.alert({msg: '智能验证成功：开发者可以在这里直接执行手机号验证成功之后的相关操作'});
		        }else{
		            api.alert({msg: '短信发送成功'});
		        }
		    }else{
		        api.alert({msg: err.code+' '+err.msg});
		    }
		});
	}
	function smsVerifyVoice(){
		smsVerify.voice({
		    phone:"18215552696",
		    country:"86"
		},function(ret, err){
		    if(ret.status){
		        api.alert({msg: '语音发送成功'});
		    }else{
		        api.alert({msg: err.code+' '+err.msg});
		    }
		});
	}
	function smsVerifyVerify(){
		smsVerify.verify({
		    phone:"18215552696",
		    country:"86",
		    code:"1234"
		},function(ret, err){
		    if(ret.status){
		        api.alert({msg: '验证成功'});
		    }else{
		        api.alert({msg: err.code+' '+err.msg});
		    }
		});
	}
	function reg_sms(){
    	//貌似是120秒内只能注册一次，不然会失败，注意下
        var param = {
        	appkey:"149d7d85f927e",
        	appsecret:"c6ecb450276d973519e31e258576f9fb"
        };
        sendsms.regSms(param);
        alert("注册成功");
    }
    var timer1 = "";
	var maxtime = 60;
    function send_sms(){
    	var tel = document.getElementById("tel").value;
        var param = {phone:tel};
        sendsms.sendMessage(param,function(ret,err){
	        if(ret.result == "ok"){
	        	maxtime = 60;
				timer1 = setInterval("send_code_jishi();", 1000);
	        	alert("短信发送成功");
	        }else{
	        	alert("发送失败："+ret.result);
	        }
        });
    }    
    function code_sms(){
        var mycode = document.getElementById("code").value;
        var param={code:mycode};
        sendsms.enterCode(param,function(ret,err){
			if(ret.result == "ok"){
				alert("验证成功");
			}else{
				alert("验证失败");
			}
		});
    }    
	function send_code_jishi(){
	    if(maxtime == 0){
	    	clearInterval(timer1);
	        $(".yzm-btn").val("重发验证码");
	    }else{
	    	maxtime--;
	    	$(".yzm-btn").val(maxtime+"秒后可重发");
	    }
	}

	function openScanner(){
		api.confirm({
		    title: '消息提示',
		    msg: '是否开启二维码扫描',
		    buttons: ['打开', '取消']
		}, function(ret, err){
		    if( ret.buttonIndex == 1 ){
		         var scanner = api.require('scanner');
		         scanner.open();
		    }else{
		         alert( 'do nothing' );
		    }
		});
	}
</script>
</html>